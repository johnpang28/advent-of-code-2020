package me.jp.aoc

import me.jp.aoc.Day03.Slope
import me.jp.aoc.Day03.countTrees
import me.jp.aoc.Day03.input

fun main() {
    val answer1 = input.countTrees(Slope(3, 1))
    println(answer1) // 254

    val answer2 = listOf(Slope(1, 1), Slope(3, 1), Slope(5, 1), Slope(7, 1), Slope(1, 2))
        .map { input.countTrees(it) }
        .reduce { acc, x -> acc * x }
    println(answer2) // 1666768320
}

typealias MapOfTrees = List<List<Boolean>>

object Day03 {

    data class Slope(val x: Int, val y: Int)

    fun MapOfTrees.countTrees(slope: Slope): Int {

        tailrec fun go(x: Int, y: Int, acc: Int): Int =
            if (y >= size) acc
            else go(x + slope.x, y + slope.y, if (hasTree(x, y)) acc + 1 else acc)

        return go(0, 0, 0)
    }

    private fun MapOfTrees.hasTree(x: Int, y: Int): Boolean = this[y].let { row -> row[x % row.size] }

    val input: MapOfTrees = """
        ....#...##.#.........#....#....
        #.......#...#...#.#............
        #..#..#.#.##....#.#........#...
        ........##...................#.
        ........#...##...#.#.###.......
        ##............#...#.....#.##...
        ...........#....###...#.....#..
        .......#......#..##..#.....#...
        ..#.#..#....#.........#...#..#.
        .........##......#.....##..##..
        ........#.....#....#..##......#
        ..#..#.......#..............#..
        .....#.#.......................
        .#.#....#.........#............
        .......#.....#.###.............
        ......##......#...........#..#.
        .#...............##...#........
        .....#..##........###.........#
        #...........#..#............#..
        .........#....#..#.#......#....
        .......#.........#..##.........
        .##.....#..................#...
        ....#............#.#....#.....#
        ..#....#...##....#...#.#...#...
        ..........#................#.#.
        #...#.#.#.####..#.#..........#.
        ..#...#.##......#...........#..
        ..#.....#...#.......#......#..#
        ..............#.......#........
        .#..#..........#.....#...#..#.#
        #........#...#......#.......#..
        #..................#...........
        ..#...#........#...#..#........
        ..............#.....#.....#..#.
        #.#.......#..............##.##.
        ....#.#.....##....#...........#
        ......#....#...#..#.......#....
        ....#..#.#.....#..##.....#....#
        ...........#.......#.#.#.......
        #.......#..##........#..#......
        .........#.##..#..............#
        ...........#............###.#..
        ..#.....#.....##...#.........#.
        ....##............##........#..
        .....###..........#......##....
        #...##..#..#..........#........
        ....#.....#.......#..#.#...##..
        .#....#........#.#.........#.#.
        ##...#.#.....#......#..........
        .....##.....#....#.....###.#..#
        ..............#..###..#...#..#.
        ....#...#....#.............#.#.
        .#.........#.....#........#.##.
        ....#.........#..........#.....
        .......#........#.#.#..........
        #........##....#.........#.....
        ..##..........#....#.#...#....#
        #...#.#......#..##..........#.#
        .....#..#...#..#...............
        #...#..............#...........
        .#...#....#..##.....#....#.#...
        .#...#.......#...#..#.##....#..
        #....#........#....#...#.......
        #..#......#.....#.....#..##....
        ......#.#....##....##..#...#...
        ..#....#.#.###..............#..
        .#.##.......#.#.#..#...#..#....
        ..#..........#.#....#..#.#....#
        ..........#...#...#..........#.
        ..........#.....#.#..#..#....##
        .#.#...##...#...........####...
        ........##..#.#..........#.##.#
        #......###...........#...#.....
        ..#.#....##.........##....#....
        #....#.##..##..#..#.....#.....#
        .##.....##....##....#.......#..
        #...#.....##....#..........#...
        ............#.#.##....#....#...
        ....#............#.....#......#
        ....................#..........
        ..#....................#..#....
        ....#.....#........#..##...#...
        #.....#.#....................##
        .#....#.#.#...#..........#....#
        ....#...#......#...#.....##...#
        .....#.........................
        .......#..#.#...#...#...#.....#
        ...#......#.##.#...#..#...##.#.
        ...........................#..#
        ..#.#.....#........##..........
        ....#...##........#.#.#..#...##
        ..##.....#..###.........##.##..
        .#..#.....#...#.............#..
        #..............##...#....##....
        .##......#.#............#......
        .............##...#.#.......#..
        .........#..#..#...............
        ........##......#....##........
        ...#.........#.#.#.............
        #..........#......#......#..#..
        .............##.#.#..#.#.#...#.
        .....#.........#...............
        ..##.#..#.....##..#........#.#.
        .#..........#.#.......#......##
        .#........................#....
        #....#....#...#..#......#......
        ........#.......#......#.....#.
        .....#....##..#...###...#....#.
        ....#.........#....#......#....
        .............#...#....#.......#
        .....#.........#..#.#..........
        .........#..#........#.#.#.....
        ......#.##......#....#.#.##.#..
        .#...#.#...#...#.#......#....##
        .#................#......#.....
        #.#.#...............#..........
        .....#.#.......#...#........#..
        #...#.#.#.##..#...........#..#.
        .............###.........#....#
        .#.....#.......##....##.......#
        ....#...#.......#.##.....#.....
        ...........##.........#...#....
        ..............#.#..#.....#..#..
        #.#...#..#.#.........#......#.#
        #.##.....##....#........#.#.#.#
        ##.#.###.........##.......#..#.
        #.....#.....................#..
        .........##........#...........
        .###........##....#...#........
        ....#.#........##...........#..
        ..........#.....#..........#..#
        ......#..............#......#..
        .....#...#......#...#...#......
        ..........#.#..#....#...#..###.
        #..##........#................#
        ..#............................
        .....#.........#.#.............
        ........#...#.....#...##......#
        ..#........#................#..
        ......#....#..#......#.........
        ...........##....#..#.#........
        .....#.............###.........
        #............#......#..#.......
        ..#..#.................#..#..##
        .......#......#.....#........#.
        ....................#..#.##...#
        .#..##...............##...#....
        ...#...#....#........#.........
        .....##...#.....###............
        .###.........#........#.....##.
        .............#...#.............
        ...#.#...............#..##..#.#
        ...#...............#..#.....#..
        ....#.#..................#...#.
        ..........#...........#.#...###
        #...#......#................#..
        ...#.#.......#...#......#.##...
        ......#..........#.............
        ##.......#.##.#...........#....
        ......#...#.#.....#............
        .#.....#.....#.....#.........#.
        ..................#............
        .#.#.#.....#......#.##.........
        .......#..##.##......#..#....#.
        ...#.#.#......#...#........#...
        ..#............#......#.......#
        ..#......#........#.........#..
        ..#..#.#.#.....#.............#.
        ..#.#..##......#...#...##......
        .##...#....##.#.#...........#..
        ..............#..#...#....#....
        .......#.#........#............
        .....##..###........#..........
        ......................#........
        ..##....#....#.................
        .##.#.###.#........#.##..#...#.
        ##................#...........#
        ....#..##.....##...............
        .#.....#..#............#.....#.
        #.........#..............#.....
        ...##.#......#...#.............
        ................#..............
        ...#.....#....##...#..#....#...
        ..............##..#...#.##..#..
        ......................#..#....#
        .......#....#..#.##.........#.#
        #...#........##.......#........
        ...##...............#.....#....
        .##...##...#...................
        .........##.#...#.........#....
        ............#............#..#..
        .............................#.
        ....#.#....#...................
        ......#......#...#..##.........
        #........#.#.#.#.#......#....#.
        .#.........#.#...#......#..#.#.
        ..............#....##.........#
        .#.......#..#....#.#.#....#....
        ...###.#.#..#...#....#....#....
        #........#....................#
        ......#...##.###..#..##...#....
        .....#........#.......#........
        #..#...........#.#.............
        ....##.#...#..##............##.
        #.#..##..#...#...#.....#.......
        ..#.............#.##..#...#.##.
        .#.....##.#..#...#...........#.
        ....#...#....................##
        ....##......#.###......#......#
        ...#...#.........#..#.##....#..
        #......#..#....###.........#...
        #...........##.............#.#.
        #..............##....#......#..
        .........#...#.#...#...#.......
        ....#....#............#.......#
        ........#...#....#......##.....
        ..........#.#..#.........#.....
        #........#.##....##......#.....
        ...#.......#...................
        ###...#...#..#.##....#.....#...
        ........##..........#.##..#....
        .....#......#..#.....#.....#.#.
        ...#..#..##..###.....##.#......
        #..#......##...#............#..
        #............#....#..#.........
        #........#.......#......#..##.#
        ...#.#.........#.#.............
        #..............#..............#
        #.#......#..........##.........
        #..##...........#..##...#......
        .....#.#.....#......#.....#.#.#
        .#.##...#...##...........#....#
        #.............#........#.......
        ..##.............#...#.........
        ....#.#......###....#..........
        ...#..#.....#..##.#....#...#.#.
        .............##................
        #.#............#........#..#.#.
        .#......#.....#...........#....
        ...#.........#...........#.##..
        .....#...#.....#..#..........#.
        ........#.#...............#.#..
        .......#..#..#.....#.......##..
        .#...#...#..#...##...#.........
        ..........##....#..#.##..#.....
        ....#.................#...#....
        .........#...#......#....#....#
        .........#..#...#.##........##.
        #.#....##.......#.#............
        ##.......##..................#.
        ......#...#......##............
        ##.#...#.#...........#..#......
        .........#.........#..#.#...#..
        .#...#.......#.#...###.........
        ................#.#.....#......
        ..#...#.....#........#.........
        .........##.###.#.#.....#...#..
        #..#..........#....#.#...#...##
        ##.#.#....#..##.............#.#
        .###....#..#...............##..
        ............#......#.#.#....#..
        ........#...#..#...#...........
        ##.........#................#..
        ...###...#.#..#...#..........##
        ...#......#......##........#...
        .......#............#..........
        .....#.....##....#.....###.....
        .#...#...#.....#..#..#....#..#.
        #.#........#..#.......##...#.##
        .....#.....##..#.##........#..#
        .....#...#...........#.........
        ..#....#.#...#..#....##...#...#
        ...........#...##.........#....
        ..#....#....##........#.####...
        #.............#.#.............#
        ...................#.....#.#..#
        .#....#.#.............#.#......
        #...........#............#.#...
        ..#.........#.#....#.......##..
        #....####......#...#......#....
        ....##....#...................#
        ....#.##....#.............#....
        .........##........#.....#..#..
        ............#...#..............
        ............#..##....#.....##.#
        ............#.....#......#.....
        ........#..#........##.#.......
        ...#.#........#..............#.
        ............#.........#..#.#...
        ................#.............#
        ..##..........##......#.#......
        ..#..#.##....#.........#...#...
        ...........##...#.#.#..........
        .#.#.......#.#...#.........#...
        .........#..#........#..#.#....
        ..........##..#.##....#....#...
        ....#...............#.......#..
        ##..........##.................
        ....#.#.#.....#..........##.#..
        ..............#.##..........##.
        ##...............#...#..#......
        ..#..#..........#......#.......
        #...#..##.#.#..................
        ....#....##......##.#...#....##
        .#...#.#....##.............#..#
        ................#......###.....
        ..#..#.............#.#.......#.
        ..#..................#.......#.
        .....#.......#....#.##...#.##..
        .....##.......#......#..#......
        #..#.......#........#..........
        ..#...#..#....#.........#......
        #..#..#......##..#.##....####..
        ......##.#.....#..#.......#....
        .##...#.....#..#...#.#.........
        #.....#........###....#...#..#.
        .#....#.#..#......#............
        .........#..#..#.....#........#
        ..#.......#..........#..#......
        ......#.......##.#....#.#.#....
        .#............#.....#.......#..
        ...#..#...............#........
        .....#.........................
    """.trimIndent().lines().map { line -> line.map { it == '#' } }
}